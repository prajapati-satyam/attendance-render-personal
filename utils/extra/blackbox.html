<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Management</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .hover-card:hover {
            transform: scale(1.05);
            transition: transform 0.3s;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-5">
        <h1 class="text-3xl font-bold text-center mb-5">Attendance Management System</h1>
        
        <div class="mb-5">
            <h2 class="text-xl font-semibold">Update Attendance</h2>
            <form id="updateForm" class="bg-white p-5 rounded shadow-md">
                <div class="mb-4">
                    <label for="subject" class="block text-gray-700">Subject</label>
                    <select id="subject" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        <!-- Options will be populated here -->
                    </select>
                </div>
                <div class="mb-4">
                    <label for="present" class="block text-gray-700">Present</label>
                    <input type="number" id="present" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="Enter Present Count" value="0">
                </div>
                <div class="mb-4">
                    <label for="absent" class="block text-gray-700">Absent</label>
                    <input type="number" id="absent" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="Enter Absent Count" value="0">
                </div>
                <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600 transition">Update Attendance</button>
            </form>
            <div id="updateMessage" class="mt-3"></div>
        </div>

        <div class="mb-5">
            <h2 class="text-xl font-semibold">All Attendance Records</h2>
            <div id="records" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Records will be populated here -->
            </div>
        </div>

        <div class="mb-5">
            <h2 class="text-xl font-semibold">Delete All Records</h2>
            <form id="deleteForm" class="bg-white p-5 rounded shadow-md">
                <input type="password" id="adminPassword" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="Enter Admin Password" required>
                <button type="submit" class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600 transition">Delete All Records</button>
            </form>
            <div id="deleteMessage" class="mt-3"></div>
        </div>

        <div class="mb-5">
            <h2 class="text-xl font-semibold">Add New Subject</h2>
            <form id="addForm" class="bg-white p-5 rounded shadow-md">
                <input type="number" id="sr" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="Serial Number" required>
                <input type="text" id="newSubject" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="Subject Name" required>
                <input type="text" id="slotType" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="Slot Type" required>
                <input type="number" id="conducted" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="Conducted" required>
                <input type="number" id="newPresent" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="Present" required>
                <input type="number" id="newAbsent" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="Absent" required>
                <input type="text" id="attendancePercentage" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="Attendance Percentage" required>
                <button type="submit" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 transition">Add Subject</button>
            </form>
            <div id="addMessage" class="mt-3"></div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const apiUrl = 'https://myattendancebot.vercel.app'; // Replace with your actual API URL

        $(document).ready(function() {
            // Fetch all records on page load
            fetchAllRecords();

            // Update attendance form submission
            $('#updateForm').on('submit', function(e) {
                e.preventDefault();
                const subject = $('#subject').val();
                const present = $('#present').val() || 0;
                const absent = $('#absent').val() || 0;

                $.post(`${apiUrl}/up`, { Subject: subject, Present: present, Absent: absent })
                    .done(function(response) {
                        $('#updateMessage').text('Updated successfully!').addClass('fade-in text-green-500');
                        fetchAllRecords();
                    })
                    .fail(function() {
                        $('#updateMessage').text('Unable to update data.').addClass('fade-in text-red-500');
                    });
            });

            // Delete all records form submission
            $('#deleteForm').on('submit', function(e) {
                e.preventDefault();
                const password = $('#adminPassword').val();

                $.post(`${apiUrl}/del`, { api: password })
                    .done(function(response) {
                        $('#deleteMessage').text('All data is deleted.').addClass('fade-in text-green-500');
                        fetchAllRecords();
                    })
                    .fail(function() {
                        $('#deleteMessage').text('Unable to delete data.').addClass('fade-in text-red-500');
                    });
            });

            // Add new subject form submission
            $('#addForm').on('submit', function(e) {
                e.preventDefault();
                const sr = $('#sr').val();
                const subject = $('#newSubject').val();
                const slotType = $('#slotType').val();
                const conducted = $('#conducted').val();
                const present = $('#newPresent').val();
                const absent = $('#newAbsent').val();
                const attendancePercentage = $('#attendancePercentage').val();

                $.post(`${apiUrl}/add`, {
                    Sr: sr,
                    Subject: subject,
                    SlotType: slotType,
                    Conducted: conducted,
                    Present: present,
                    Absent: absent,
                    AttendancePercentage: attendancePercentage
                })
                .done(function(response) {
                    $('#addMessage').text('Added successfully!').addClass('fade-in text-green-500');
                    $('#subject').append(new Option(subject, subject)); // Add new subject to select
                    fetchAllRecords();
                })
                .fail(function() {
                    $('#addMessage').text('Not able to add data.').addClass('fade-in text-red-500');
                });
            });
        });

        function fetchAllRecords() {
            $.get(`${apiUrl}/all`)
                .done(function(data) {
                    $('#records').empty();
                    data.forEach(record => {
                        $('#records').append(`
                            <div class="bg-white p-4 rounded shadow-md hover-card">
                                <h3 class="font-bold">${record.Subject}</h3>
                                <p>Slot Type: ${record.SlotType}</p>
                                <p>Conducted: ${record.Conducted}</p>
                                <p>Present: ${record.Present}</p>
                                <p>Absent: ${record.Absent}</p>
                                <p>Attendance Percentage: ${record.AttendancePercentage}</p>
                            </div>
                        `);
                    });
                })
                .fail(function() {
                    $('#records').html('<p class="text-red-500">Failed to load records.</p>');
                });
        }
    </script>
</body>
</html>